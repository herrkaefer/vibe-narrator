2025-11-26 11:25:12,627 [INFO] üöÄ Narrator MCP Server initialized
2025-11-26 11:25:12,627 [INFO] üìù Narrate logs: /Users/herrk/dev-local/vibe-narrator/narrator-mcp/logs/narrator_20251126_112512.log
2025-11-26 11:25:12,628 [INFO] üöÄ Narrator MCP Server initialized
2025-11-26 11:25:12,629 [INFO] üìù Narrate logs: /Users/herrk/dev-local/vibe-narrator/narrator-mcp/logs/narrator_20251126_112512.log
2025-11-26 11:25:12,685 [INFO] StreamableHTTP session manager started
2025-11-26 11:25:12,685 [INFO] StreamableHTTP session manager started
2025-11-26 11:25:12,687 [INFO] StreamableHTTP session manager shutting down
2025-11-26 11:25:12,687 [INFO] üõë Narrator MCP Server shutting down
2025-11-26 13:04:52,383 [INFO] Created new transport with session ID: c7434502c6544552889cf716a808b670
2025-11-26 13:04:52,431 [INFO] Created new transport with session ID: 2ac5cee01860479fa52a2cee54ac9d9c
2025-11-26 13:04:52,470 [INFO] Processing request of type CallToolRequest
2025-11-26 13:04:52,501 [INFO] üõë Narrator MCP Server shutting down
2025-11-26 13:04:52,502 [INFO] StreamableHTTP session manager shutting down
2025-11-26 13:04:52,548 [ERROR] unhandled exception during asyncio.run() shutdown
task: <Task finished name='mcp.server.streamable_http_manager.StreamableHTTPSessionManager._handle_stateful_request.<locals>.run_server' coro=<StreamableHTTPSessionManager._handle_stateful_request.<locals>.run_server() done, defined at /Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/mcp/server/streamable_http_manager.py:236> exception=BaseExceptionGroup('unhandled errors in a TaskGroup', [BaseExceptionGroup('unhandled errors in a TaskGroup', [BaseExceptionGroup('unhandled errors in a TaskGroup', [SystemExit(1)])])])>
  + Exception Group Traceback (most recent call last):
  |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/mcp/server/streamable_http_manager.py", line 237, in run_server
  |     async with http_transport.connect() as streams:
  |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/contextlib.py", line 231, in __aexit__
  |     await self.gen.athrow(typ, value, traceback)
  |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/mcp/server/streamable_http.py", line 845, in connect
  |     async with anyio.create_task_group() as tg:
  |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | BaseExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Exception Group Traceback (most recent call last):
    |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/mcp/server/streamable_http.py", line 904, in connect
    |     yield read_stream, write_stream
    |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/mcp/server/streamable_http_manager.py", line 241, in run_server
    |     await self.app.run(
    |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/fastmcp/server/low_level.py", line 136, in run
    |     async with AsyncExitStack() as stack:
    |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/contextlib.py", line 745, in __aexit__
    |     raise exc_details[1]
    |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/contextlib.py", line 728, in __aexit__
    |     cb_suppress = await cb(*exc_details)
    |                   ^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/mcp/shared/session.py", line 220, in __aexit__
    |     return await self._task_group.__aexit__(exc_type, exc_val, exc_tb)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
    |     raise BaseExceptionGroup(
    | BaseExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
    +-+---------------- 1 ----------------
      | Exception Group Traceback (most recent call last):
      |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/fastmcp/server/low_level.py", line 148, in run
      |     async with anyio.create_task_group() as tg:
      |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 781, in __aexit__
      |     raise BaseExceptionGroup(
      | BaseExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
      +-+---------------- 1 ----------------
        | Traceback (most recent call last):
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/fastmcp/tools/tool_manager.py", line 160, in call_tool
        |     return await tool.run(arguments)
        |            ^^^^^^^^^^^^^^^^^^^^^^^^^
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/fastmcp/tools/tool.py", line 330, in run
        |     result = type_adapter.validate_python(arguments)
        |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/pydantic/type_adapter.py", line 441, in validate_python
        |     return self.validator.validate_python(
        |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        | pydantic_core._pydantic_core.ValidationError: 3 validation errors for call[configure]
        | api_key
        |   Missing required argument [type=missing_argument, input_value={'llm_api_key': 'sk-proj-...52zJEoQLwMzRd6enWP5DMA'}, input_type=dict]
        |     For further information visit https://errors.pydantic.dev/2.12/v/missing_argument
        | llm_api_key
        |   Unexpected keyword argument [type=unexpected_keyword_argument, input_value='sk-proj-jNeIVi9cIBTxUmvP...352zJEoQLwMzRd6enWP5DMA', input_type=str]
        |     For further information visit https://errors.pydantic.dev/2.12/v/unexpected_keyword_argument
        | llm_model
        |   Unexpected keyword argument [type=unexpected_keyword_argument, input_value='gpt-4o-mini', input_type=str]
        |     For further information visit https://errors.pydantic.dev/2.12/v/unexpected_keyword_argument
        | 
        | During handling of the above exception, another exception occurred:
        | 
        | Traceback (most recent call last):
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/rich/console.py", line 2038, in _check_buffer
        |     self._write_buffer()
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/rich/console.py", line 2107, in _write_buffer
        |     self.file.write(text)
        | BrokenPipeError: [Errno 32] Broken pipe
        | 
        | During handling of the above exception, another exception occurred:
        | 
        | Traceback (most recent call last):
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2325, in run
        |     return runner.run(wrapper())
        |            ^^^^^^^^^^^^^^^^^^^^^
        |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/asyncio/runners.py", line 118, in run
        |     return self._loop.run_until_complete(task)
        |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/asyncio/base_events.py", line 641, in run_until_complete
        |     self.run_forever()
        |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/asyncio/base_events.py", line 608, in run_forever
        |     self._run_once()
        |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/asyncio/base_events.py", line 1936, in _run_once
        |     handle._run()
        |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/asyncio/events.py", line 84, in _run
        |     self._context.run(self._callback, *self._args)
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/mcp/server/lowlevel/server.py", line 650, in _handle_message
        |     await self._handle_request(message, req, session, lifespan_context, raise_exceptions)
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/mcp/server/lowlevel/server.py", line 698, in _handle_request
        |     response = await handler(req)
        |                ^^^^^^^^^^^^^^^^^^
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/mcp/server/lowlevel/server.py", line 502, in handler
        |     results = await func(tool_name, arguments)
        |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/fastmcp/server/server.py", line 1072, in _call_tool_mcp
        |     result = await self._call_tool_middleware(key, arguments)
        |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/fastmcp/server/server.py", line 1095, in _call_tool_middleware
        |     return await self._apply_middleware(
        |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/fastmcp/server/server.py", line 479, in _apply_middleware
        |     return await chain(context)
        |            ^^^^^^^^^^^^^^^^^^^^
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/fastmcp/server/server.py", line 1133, in _call_tool
        |     return await self._tool_manager.call_tool(
        |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/fastmcp/tools/tool_manager.py", line 162, in call_tool
        |     logger.exception(f"Error validating tool {key!r}: {e}")
        |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/logging/__init__.py", line 1524, in exception
        |     self.error(msg, *args, exc_info=exc_info, **kwargs)
        |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/logging/__init__.py", line 1518, in error
        |     self._log(ERROR, msg, args, **kwargs)
        |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/logging/__init__.py", line 1634, in _log
        |     self.handle(record)
        |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/logging/__init__.py", line 1644, in handle
        |     self.callHandlers(record)
        |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/logging/__init__.py", line 1706, in callHandlers
        |     hdlr.handle(record)
        |   File "/Users/herrk/.pyenv/versions/3.11.11/lib/python3.11/logging/__init__.py", line 978, in handle
        |     self.emit(record)
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/rich/logging.py", line 178, in emit
        |     self.console.print(log_renderable)
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/rich/console.py", line 1697, in print
        |     with self:
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/rich/console.py", line 870, in __exit__
        |     self._exit_buffer()
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/rich/console.py", line 826, in _exit_buffer
        |     self._check_buffer()
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/rich/console.py", line 2040, in _check_buffer
        |     self.on_broken_pipe()
        |   File "/Users/herrk/dev-local/vibe-narrator/narrator-mcp/.venv/lib/python3.11/site-packages/rich/console.py", line 2025, in on_broken_pipe
        |     raise SystemExit(1)
        | SystemExit: 1
        +------------------------------------
